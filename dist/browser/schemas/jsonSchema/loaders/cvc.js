'use strict';var _regenerator=require("babel-runtime/regenerator"),_regenerator2=_interopRequireDefault(_regenerator),_asyncToGenerator2=require("babel-runtime/helpers/asyncToGenerator"),_asyncToGenerator3=_interopRequireDefault(_asyncToGenerator2),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2);function _interopRequireDefault(a){return a&&a.__esModule?a:{default:a}}var path=require("path"),_require=require("../../../lib/stringUtils"),parseIdentifier=_require.parseIdentifier,_require2=require("../../../services"),services=_require2.services,rootUri="http://identity.com/schemas/",BASE_URI="http://localhost:7500",CVCSchemaLoader=function(){function a(){(0,_classCallCheck3.default)(this,a)}return(0,_createClass3.default)(a,[{key:"schemaId",value:function(a){return rootUri+a}},{key:"valid",value:function(a){return /^(claim|credential|type)-(cvc|alt):.*$/.test(a)}},{key:"loadSchema",value:function(){var a=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function a(b){var c,d;return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=parseIdentifier(b),d=this.local(c),null===d&&(d=this.remote(c)),a.abrupt("return",d);case 4:case"end":return a.stop();}},a,this)}));return function(){return a.apply(this,arguments)}}()},{key:"remote",value:function(){var a=(0,_asyncToGenerator3.default)(_regenerator2.default.mark(function a(b){var c,d;return _regenerator2.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return c=BASE_URI+"/"+b[1]+"/"+b[4]+"/"+b[1]+"-"+b[2]+".schema.json",d=null,a.prev=2,a.next=5,services.container.Http.request(c);case 5:d=a.sent,a.next=19;break;case 8:if(a.prev=8,a.t0=a["catch"](2),!(!a.t0.statusCode||500<=a.t0.statusCode&&599>=a.t0.statusCode)){a.next=16;break}return a.next=13,services.container.Http.request(c);case 13:d=a.sent,a.next=18;break;case 16:if(!(400>a.t0.statusCode||500<=a.t0.statusCode)){a.next=18;break}throw a.t0;case 18:return a.abrupt("return",null);case 19:return a.abrupt("return",JSON.parse(d));case 20:case"end":return a.stop();}},a,this,[[2,8]])}));return function(){return a.apply(this,arguments)}}()},{key:"local",value:function(a){return null}}]),a}();module.exports={CVCSchemaLoader:CVCSchemaLoader};